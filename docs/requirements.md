# TwitterライクSNS AIRIM開発要件定義書 (MVP)

## 1. 概要
Twitter (X) ライクなテキストコミュニケーションを中心としたSNSをWebアプリケーションとして構築する。
個人開発におけるMVP (Minimum Viable Product) を目指し、機能の複雑性を抑えつつコア体験を確立する。

## 2. アーキテクチャ・技術選定
* **Frontend:** Next.js (App Router), TypeScript, Tailwind CSS, shadcn/ui
* **Auth (IDaaS):** **Clerk**
    * 認証機能およびユーザー管理UI（プロフィール画像変更、メアド変更等）として採用。
* **Backend:** Next.js Server Actions
* **Database Access (ORM):** **Prisma** または **Drizzle ORM**
    * Supabaseへのロックインを避けるため、アプリケーションコード（ORM）でDB操作を行う。
* **Infrastructure:**
    * **Database:** Supabase (PostgreSQL) ※Auth機能は使用しない
    * **Storage:** Supabase Storage (画像保存用)
    * **Hosting:** Vercel

## 3. 機能要件

### 3.1 アカウント管理 (Auth/User)
* **アカウント作成・ログイン**
    * **Clerk** を利用して実装。
    * メールアドレス/パスワードによる認証。
    * **ソーシャルログイン対応:** Googleアカウント, X (旧Twitter) アカウント。
    * ログアウト機能。
* **プロフィール管理**
    * 基本設定（アイコン変更、パスワード変更等）は Clerk の標準コンポーネント (`<UserProfile />`) を利用する。
    * **アプリ固有プロフィール:** 以下の項目は自社DB (`profiles` テーブル) で管理し、ClerkのユーザーIDと紐付ける。
        * **アカウントID (@username):** システム全体でユニーク、必須。
        * **表示名:** 必須。
        * **自己紹介 (Bio):** 空文字を許容。
    * アイコン・プロフィール画面のヘッダー設定機能
        * 画像アップロードによりアイコン・プロフィール画面のヘッダー設定ができる
* **ユーザー検索**
    * アカウントIDまたは表示名による前方一致検索。

### 3.2 投稿機能 (Post)
* **投稿作成**
    * 本文: 最大200文字。
    * 画像添付: 最大4枚までアップロード可能。
    * リプライ（返信）: 特定の投稿に対する返信を作成できる。
* **投稿削除**
    * 自身の投稿に限り削除が可能。
* **タイムライン表示**
    * **グローバルタイムライン:** 全ユーザーの投稿を時系列（降順）表示。
    * **フォロー中タイムライン:** フォローしているユーザーの投稿のみを時系列表示。
    * **表示要素:** アバター, 名前, ID, 本文, 画像, 相対時刻（例: "5分前"）, ふぁぼ数, リポスト数。
    * **無限スクロール:** ページネーションではなくスクロールによる追加読み込み。
* **投稿詳細表示**
    * 投稿単体の詳細表示画面。
    * その投稿に対するリプライ一覧を表示する。

### 3.3 ソーシャルアクション (Interaction)
* **フォロー / フォロー解除**
    * 他者のプロフィール画面で実行可能。
* **ふぁぼ (Like)**
    * 投稿に対して「星形アイコン」で好意を示す。
* **リポスト**
    * 他者の投稿を自分のタイムラインに再投稿する。
    * ※引用リポストは初期開発スコープ外。

### 3.4 通知機能 (Notification)
* **通知トリガー**
    * フォローされた時、自投稿へのふぁぼ/リポスト/リプライ時。
* **通知画面**
    * 通知内容を時系列リスト表示。未読バッジ表示。
* **通知設定**
    * 各種通知のON/OFF設定。

## 4. 画面構成

### 共通レイアウト
* **サイドバー:** ナビゲーション（ホーム, 検索, 通知, 設定, プロフィール, 投稿ボタン）。
* **認証状態:** 未ログイン時はログイン/サインアップ画面へ誘導（Clerk Middlewareで制御）。

### 各画面詳細
1.  **ホーム画面**
    * タブ（おすすめ/フォロー中）、投稿フォーム、タイムライン。
2.  **投稿詳細画面**
    * 親投稿表示、リプライ一覧。
3.  **検索画面**
    * 投稿全文検索、ユーザー検索。
4.  **通知画面**
    * 通知リスト。
5.  **プロフィール画面**
    * ヘッダー情報、投稿一覧タブ。
    * **「プロフィール編集」:** アプリ固有情報（名前、Bio）の編集フォーム。
    * **「アカウント設定」:** Clerk提供のモーダルを開き、メアドやパスワードを管理。
6.  **設定画面**
    * 通知設定スイッチ。
    * ログアウトボタン（Clerk）。

## 5. 非機能要件
* **セキュリティ (認可):**
    * Supabase RLSには依存せず、**Next.js Server Actions 内で Clerk の `auth().userId` を検証**し、ORM経由でデータアクセス制御を行う。
* **パフォーマンス:** 画像最適化、インデックス設計によるクエリ高速化。
* **レスポンシブ:** モバイル/PC対応。

## 6. 初期開発スコープ外（Future Work）
* ネイティブアプリ
* 引用リポスト、投稿の編集機能
* DM、ハッシュタグ、動画
* 鍵垢機能
