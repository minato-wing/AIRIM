# è‡ªå‹•ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½

## æ¦‚è¦

ã‚µãƒ¼ãƒãƒ¼èµ·å‹•æ™‚ã«è‡ªå‹•çš„ã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚

## å®Ÿè£…å†…å®¹

### 1. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«:** `scripts/migrate.js`

- `prisma migrate deploy` ã‚’å®Ÿè¡Œ
- æœªé©ç”¨ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ã¿ã‚’é©ç”¨ï¼ˆæ—¢ã«é©ç”¨æ¸ˆã¿ã®å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—ï¼‰
- æœ¬ç•ªç’°å¢ƒã§ã‚‚å®‰å…¨ã«ä½¿ç”¨å¯èƒ½

### 2. package.json ã®æ›´æ–°

```json
{
  "scripts": {
    "dev": "node scripts/migrate.js && next dev",
    "start": "node scripts/migrate.js && next start",
    "migrate": "node scripts/migrate.js"
  }
}
```

### 3. å‹•ä½œ

#### é–‹ç™ºç’°å¢ƒ
```bash
npm run dev
```

1. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ
2. æœªé©ç”¨ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒã‚ã‚Œã°é©ç”¨
3. Next.js é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•

#### æœ¬ç•ªç’°å¢ƒ
```bash
npm run start
```

1. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ
2. æœªé©ç”¨ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒã‚ã‚Œã°é©ç”¨
3. Next.js æœ¬ç•ªã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•

#### ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ã¿å®Ÿè¡Œ
```bash
npm run migrate
```

## å‹•ä½œç¢ºèª

### æ—¢ã«ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ¸ˆã¿ã®å ´åˆ

```
ğŸ”„ Checking database migrations...
Datasource "db": PostgreSQL database "postgres", schema "public" at "..."

3 migrations found in prisma/migrations

No pending migrations to apply.
âœ… Database migrations completed successfully
```

### æœªé©ç”¨ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒã‚ã‚‹å ´åˆ

```
ğŸ”„ Checking database migrations...
Datasource "db": PostgreSQL database "postgres", schema "public" at "..."

3 migrations found in prisma/migrations

Applying migration `20260104200511_init`
Applying migration `20260105140753_add_avatar_header_to_profile`
Applying migration `20260108182839_add_tag_feature`

The following migration(s) have been applied:
...
âœ… Database migrations completed successfully
```

## åˆ©ç‚¹

1. **è‡ªå‹•åŒ–:** æ‰‹å‹•ã§ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒãªã„
2. **å®‰å…¨æ€§:** `prisma migrate deploy` ã¯æœ¬ç•ªç’°å¢ƒã§ã‚‚å®‰å…¨ã«ä½¿ç”¨å¯èƒ½
3. **å†ªç­‰æ€§:** æ—¢ã«é©ç”¨æ¸ˆã¿ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã‚‹
4. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°:** ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¤±æ•—æ™‚ã¯ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ã‚’ä¸­æ­¢

## æ³¨æ„äº‹é …

### é–‹ç™ºç’°å¢ƒã§ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆ

æ–°ã—ã„ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã™ã‚‹å ´åˆã¯ã€å¾“æ¥é€šã‚Šä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨:

```bash
npx prisma migrate dev --name migration_name
```

ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯:
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«é©ç”¨
- Prisma Client ã‚’å†ç”Ÿæˆ

### CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

GitHub Actions ãªã©ã® CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã¯ã€ãƒ“ãƒ«ãƒ‰å‰ã«è‡ªå‹•çš„ã«ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Ÿè¡Œã•ã‚Œã¾ã™:

```yaml
- name: Build
  run: npm run build
  # å†…éƒ¨ã§ prisma generate ãŒå®Ÿè¡Œã•ã‚Œã‚‹

- name: Start
  run: npm run start
  # èµ·å‹•å‰ã«è‡ªå‹•çš„ã«ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Ÿè¡Œã•ã‚Œã‚‹
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒå¤±æ•—ã™ã‚‹å ´åˆ

1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚’ç¢ºèª
   ```bash
   npx prisma db pull
   ```

2. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å±¥æ­´ã‚’ç¢ºèª
   ```bash
   npx prisma migrate status
   ```

3. æ‰‹å‹•ã§ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œ
   ```bash
   npx prisma migrate deploy
   ```

### ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒå¿…è¦ãªå ´åˆ

Prisma ã¯è‡ªå‹•ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãªã„ãŸã‚ã€æ‰‹å‹•ã§å¯¾å¿œ:

1. å•é¡Œã®ã‚ã‚‹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤
2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ‰‹å‹•ã§ä¿®æ­£
3. æ–°ã—ã„ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆ

```bash
npx prisma migrate dev --name fix_issue
```
